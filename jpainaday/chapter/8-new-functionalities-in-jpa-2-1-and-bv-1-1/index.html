<!DOCTYPE html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ --> 
<!--[if lt IE 7 ]> <html lang="en-US" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en-US" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en-US" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en-US" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><html lang="en-US" class="no-js"> <!--<![endif]-->
<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js">
      </script>
    <![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta itemprop='author' content='Marcus Schiesser and Martin Schmollinger' id='author'>
<meta itemprop='copyrightHolder' content='dpunkt.verlag GmbH. Authorized translation of the German edition titled "Workshop Java EE 7. Ein praktischer Einstieg in die Java Enterprise Edition mit dem Web Profile", 2nd edition. ISBN 978-3-86490-195-9' id='copyrightHolder'>
<meta itemprop='copyrightYear' content='2015' id='copyrightYear'>
<meta itemprop='datePublished' content='2016-02-24' id='datePublished'>
<meta itemprop='description' content='This Cloud Tutorial is the third of a series building a web application with Java EE. It will see us implement the object-relational mapping of our data to a data base.' id='description'>
<meta itemprop='image' content='/jpainaday/wp-content/uploads/sites/8/2016/01/jpainaday_cover.jpg' id='image'>
<meta itemprop='inLanguage' content='en' id='inLanguage'>
<meta itemprop='publisher' content='TurnGeek' id='publisher'>
<link rel="shortcut icon" href="/jpainaday/wp-content/plugins/pressbooks/themes-book/pressbooks-custom-css/favicon.ico" />
<title>8 New Functionalities in JPA 2.1 and Bean Validation 1.1 | Cloud Tutorial &#8211; JPA in a Day</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="/jpainaday/xmlrpc.php" />

		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.turngeek.press\/jpainaday\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56806,55356,56826),0,0),c.toDataURL().length>3e3):("simple"===a?d.fillText(String.fromCharCode(55357,56835),0,0):d.fillText(String.fromCharCode(55356,57135),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='pressbooks-book-css'  href='/jpainaday/wp-content/plugins/pressbooks/themes-book/pressbooks-book/style.css' type='text/css' media='screen, print' />
<link rel='stylesheet' id='pressbooks-custom-css-css'  href='/jpainaday/wp-content/uploads/sites/8/custom-css/web.css?ver=4.4' type='text/css' media='screen' />
<script type='text/javascript' src='/jpainaday/wp-includes/js/jquery/jquery.js?ver=1.11.3'></script>
<script type='text/javascript' src='/jpainaday/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='/jpainaday/wp-content/plugins/pressbooks/themes-book/pressbooks-book/js/script.js?ver=1.0'></script>
<script type='text/javascript' src='/jpainaday/wp-content/plugins/pressbooks/themes-book/pressbooks-book/js/pop-out.js?ver=1.0'></script>
<link rel='https://api.w.org/' href='/jpainaday/wp-json/' />
<link rel='prev' title='7 What We Haven’t Covered' href='/jpainaday/chapter/7-what-we-havent-covered/' />
<link rel='next' title='9 Exercises' href='/jpainaday/chapter/9-exercises/' />
<meta name="generator" content="WordPress 4.4" />
<link rel='shortlink' href='/jpainaday/?p=113' />
<link rel="alternate" type="application/json+oembed" href="/jpainaday/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.turngeek.press%2Fjpainaday%2Fchapter%2F8-new-functionalities-in-jpa-2-1-and-bv-1-1%2F" />
<link rel="alternate" type="text/xml+oembed" href="/jpainaday/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.turngeek.press%2Fjpainaday%2Fchapter%2F8-new-functionalities-in-jpa-2-1-and-bv-1-1%2F&#038;format=xml" />
<style type="text/css">
/* <![CDATA[ */
img.latex { vertical-align: middle; border: none; background: none; }
/* ]]> */
</style>

</head>
<body class="single single-chapter postid-113" id="8newfunctionalitiesinjpa2.1andbeanvalidation1.1">
	<!-- Faccebook share js sdk -->
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	  if (d.getElementById(id)) return;
	  js = d.createElement(s); js.id = id;
	  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
	  fjs.parentNode.insertBefore(js, fjs);
	}(document, "script", "facebook-jssdk"));</script>

<!-- a11y toolbar -->
<div class="a11y-toolbar">
	</div>
<!-- // a11y toolbar -->


	   	 
		<span itemscope itemtype="http://schema.org/WebPage" itemref="about copyrightHolder copyrightYear inLanguage publisher">		
		<div class="nav-container">
				<nav>
			
			 		<!-- Book Title -->
				    <h1 class="book-title"><a href="/jpainaday/" title="Cloud Tutorial &#8211; JPA in a Day" rel="home">Cloud Tutorial &#8211; JPA in a Day</a></h1>
			    
			   
			    
					    <div class="sub-nav-left">
							<!-- Logo -->
							<h2 class="pressbooks-logo"><a href="/">TurnGeek Books</a></h2>
					    </div> <!-- end .sub-nav-left -->
			    
			    <div class="sub-nav-right">
			    
					    	
						
						<!-- --> 
				
				</div> <!-- end .sub-nav-right -->
			</nav>
			      
			  <div class="sub-nav">       
			     <!-- Author Name -->   
			    <div class="author-wrap"> 
			    									     	<h3>Marcus Schiesser and Martin Schmollinger</h3>
		     					     </div> <!-- end .author-name -->
		     
			  </div><!-- end sub-nav -->  
			    
				 
		</div> <!-- end .nav-container -->

	<div class="wrapper"><!-- for sitting footer at the bottom of the page -->	    
			<div id="wrap">	    
				<div id="content">

	 	
							<h2 class="entry-title">8 New Functionalities in JPA 2.1 and Bean Validation 1.1</h2>
					<div class="nav">
  	<span class="previous"><a href="/jpainaday/chapter/7-what-we-havent-covered/">Previous</a></span>
  <!-- 	<h2 class="entry-title">8 New Functionalities in JPA 2.1 and Bean Validation 1.1</h2> -->
  	<span class="next"><a href="/jpainaday/chapter/9-exercises/">Next</a></span>
    </div>				<div id="post-113" class="type-1 post-113 chapter type-chapter status-publish hentry">
					
					<div class="entry-content">
					  				    									
					<p>As in the previous chapters, this last section will address some of the new functionalities available in Java EE 7. Specifically, these are a few minor innovations thaat are not used in our sample application but which are worth knowing about nevertheless.</p>
<h3>8.1 Bean Validation At The Method Level</h3>
<p>The authors have found bean validation at the method level to be an interesting development in Java EE with regards to JPA and Bean Validation.</p>
<p>In <a href="/jpainaday/chapter/6-checking-inputs-using-bean-validation/" target="_blank">section 6</a>, we learned about how conditions of attributes can be upheld and validated using annotations. With Bean Validation 1.1, this can also be carried out for the parameters and return values of methods. There is currently no good opportunity to use it in our sample application. Because of this, we’ll study the following method for creating a donation with parameters:</p>
<pre class="lang:java decode:true">@NotNull
public Donation createSpende(Long campaignId,
    @Size(min=5, max=40) String donorName,
    @DecimalMin(value="1.00") Double amount,
    @Pattern(regexp="[A-Z]{2}[0-9]{2}[A-Z0-9]{12,30}") String iban,
    @Size(min=4, max=40) String nameOfBank) {...
</pre>
<p>The method creates a <code>Donation</code> object using the specified parameters. The annotations from the Bean Validation API serve to ensure that the input parameters correspond to the technical conditions of a <code>Donation</code> object and that a non-empty <code>Donation</code> object (via the annotation <code>@NotNull</code>) is returned.</p>
<h3>8.2 Extended CDI Support</h3>
<p>In<a href="/jpainaday/chapter/7-what-we-havent-covered/"> section 7.4</a>, we learned about the concept of the <code>EntityListener</code>. With JPA 2.1, we are able to inject it with CDI beans. If we look at the example from the section once more, we see that we can use <code>@Inject</code> to insert the logger from the class <code>Resources</code> in the <code>DateUpdateEntityListener</code>. The callback method of the <code>EntityListener</code> can then use methods in the logger for several functions, including recording the invocation of the method in a log file.</p>
<p>Likewise, the Bean Validation API benefits from extended CDI support. By the time of Bean Validation 1.0, it was already possible to create custom conditions; this was achieved by implementing a class as it stands with the interface <code>ConstraintValidator</code>. The only new feature is the the implementation can now inject CDI beans.</p>
<h3>8.3 Invoking Stored Procedures and Functions</h3>
<p>Virtually every database supports so-called “stored procedures”. These are methods that are executed directly on the database server instead of on the application server. Database systems usually provide these stored procedures with their own languages, such as the PL/SQL<a class="footnote" title="https://en.wikipedia.org/wiki/PL/SQL" id="return-footnote-113-1" href="#footnote-113-1"><sup class="footnote">[1]</sup></a> language used for Oracle databases. For this reason, stored procedures are not easy to migrate to other database systems.</p>
<p>Their advantage, however, lies in their frequently greater execution speed, since less data must be exchanged between the application and database servers than for the execution of a Java method.</p>
<p>Stored procedures are therefore normally used for processing larger amounts of data, such as within a background job.</p>
<p>Before JPA 2.1, there was no standard for invoking stored procedures. JPA 2.1 made it possible &#8211; in the same way as with <code>NamedQueries</code> &#8211; to create a so-called <code>NamedStoredProcedureQuery</code> for invoking a stored procedure. In the following example, a special query of this kind is defined and can then be used to start a stored procedure with the name <code>doBackgroundJob</code>:</p>
<pre class="lang:java decode:true">@Entity
@NamedStoredProcedureQuery(name="backgroundJob", procedureName="doBackgroundJob")
public class Something { ...
</pre>
<p>The <code>NamedStoredProcedureQuery</code> that is created can then be resolved with the identifier <code>backgroundJob</code> using the <code>EntityManager</code>:</p>
<pre class="lang:java decode:true">StoredProcedureQuery query = entityManager.createNamedStoredProcedureQuery("backgroundJob");
</pre>
<p>We will obtain the object query of the type <code>StoredProcedureQuery</code> as a return value. Then, we can add parameters for the invocation of the Stored Procedure before invoking it with the method execute. The following example uses the integer parameter  20:</p>
<pre class="lang:java decode:true">query.registerStoredProcedureParameter(1, Integer.class, ParameterMode.IN);
query.setParameter(1, 20);
query.execute();
</pre>
<p>Alongside Stored Procedures, database systems also support the development of custom functions. In Oracle, these are also created using PL/SQL. JPA 2.1 supports the invocation of such functions within JPQL queries as one of its new functions. To accomplish this, the keyword <code>FUNCTION</code> is used within the request.</p>
<p>Let’s suppose there is a database function with the name validIban that determines whether a certain IBAN is valid. In this case, the following expression could be used to select all campaigns with a valid IBAN:</p>
<pre class="lang:java decode:true">SELECT c FROM CAMPAIGN c WHERE FUNCTION(‘validIban’, c.account.iban)
</pre>
<h3>8.4 Bulk Write Operations With The Criteria API</h3>
<p>Even before JPA 2.1, it was possible to edit multiple data sets simultaneously using a JPQL query. In the following simple example, the donation goal is set to 1,000 euros for all campaigns with a minimum donation amount of 10 euros:</p>
<pre class="lang:java decode:true">UPDATE CAMPAIGN AS c SET c.targetAmount = 1000.00 WHERE c.donationMinimum &gt; 10.00
</pre>
<p>Such bulk write operations are only possible with the Criteria API. To implement our example, we first of all require an instance of the class <code>CriteriaUpdate</code>, which is created for a <code>Campaign</code> object using the <code>CriteriaBuilder cb</code> as follows:</p>
<pre class="lang:java decode:true">CriteriaUpdate&lt;Campaign&gt; q = cb.createCriteriaUpdate(Campaign.class);
</pre>
<p>We can set the desired query on this object as follows:</p>
<pre class="lang:java decode:true">Root&lt;Campaign&gt; c = q.from(Campaign.class);
q.set(c.get("targetAmount"), 1000.00).where(cb.gt(c.get("donationMinimum"), 10.00));
</pre>
<p>Next, the resulting query can be executed as normal using the <code>EntityManager</code>:</p>
<pre class="lang:java decode:true">Query query = entityManager.createQuery(q);
query.executeUpdate();
</pre>
<h3>Discussion</h3>
<p>Use the message board below to give the authors your feedback or to discuss this page&#8217;s topic with other readers (in English please!). Please don&#8217;t expect the authors to answer directly, but they might update the content of this site according to your feedback.<br />
<script src="/js/disqus.js" type="text/javascript"></script></p>
<hr /><div class="footnotes"><ol><li id="footnote-113-1"><a href="https://en.wikipedia.org/wiki/PL/SQL" target="_blank">https://en.wikipedia.org/wiki/PL/SQL</a> <a href="#return-footnote-113-1" class="return-footnote">&crarr;</a></li></ol></div>
					</div><!-- .entry-content -->
				</div><!-- #post-## -->

			
				</div><!-- #content -->
			
				<!-- Share buttons -->
	<div class="share-wrap-single">
		<ul class="share share-single">
						<li class="email"><a href="mailto:?subject=I%20wanted%20to%20share%20this%20post%20with%20you%20from%20Cloud%20Tutorial%20-%20JPA%20in%20a%20Day&amp;body=8%20New%20Functionalities%20in%20JPA%202.1%20and%20Bean%20Validation%201.1%20-%20http%3A%2F%2Fwww.turngeek.press%2Fjpainaday%2Fchapter%2F8-new-functionalities-in-jpa-2-1-and-bv-1-1%2F" title="Email to a friend" target="_blank">Share via Email</a>
			</li>
			<li class="twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-width="97px">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></li>
			<li class="facebook"><div class="fb-like" data-send="false" data-layout="button_count" data-width="60" data-show-faces="false"></div></li>
									
		</ul>
	</div><!-- end .share-wrap-single --> 
			
				
		
	<div id="sidebar">

		<ul id="booknav">
		<!-- If Logged in show ADMIN -->
								
				<li class="home-btn"><a href="/jpainaday">Home</a></li>

		<!-- TOC button always there -->
				<li class="toc-btn"><a href="/jpainaday/table-of-contents">Table of Contents</a></li>
			</ul>

		<!-- Pop out TOC only on READ pages -->
						<div id="toc">
			<a href="#" class="close">Close</a>
			<ul>
				<li><h4><!-- Front-matter --></h4></li>
				<li>
					<ul>
																		<li class="front-matter introduction"><a href="/jpainaday/front-matter/introduction/">Introduction</a>
              						</li>
											</ul>
				</li>
								<li><h4>								Chapters								</h4></li>
				<li>
					<ul>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/1-about-jpa/">1 About JPA</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/2-annotating-entities/">2 Annotating Entities</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/3-extending-services-to-include-data-access/">3 Extending Services to Include Data Access</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/4-storing-the-data-transactionally/">4 Storing the Data Transactionally</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/5-persisting-and-displaying-donations/">5 Persisting and Displaying Remaining Entities</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/6-checking-inputs-using-bean-validation/">6 Checking Inputs Using Bean Validation</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/7-what-we-havent-covered/">7 What We Haven’t Covered</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/8-new-functionalities-in-jpa-2-1-and-bv-1-1/">8 New Functionalities in JPA 2.1 and Bean Validation 1.1</a>
                							</li>
																				<li class="chapter type-1"><a href="/jpainaday/chapter/9-exercises/">9 Exercises</a>
                							</li>
											</ul>
				</li>
								<li><h4><!-- Back-matter --></h4></li>
				<li>
					<ul>
																		<li class="back-matter suggested-reading"><a href="/jpainaday/back-matter/whatnext/">What Next?</a>
              						</li>
											</ul>
				</li>
			</ul>
		</div><!-- end #toc -->
		

	</div><!-- end #sidebar -->
	
	</div><!-- #wrap -->
	<div class="push"></div>
	
	</div><!-- .wrapper for sitting footer at the bottom of the page -->


<div class="footer">
	<div class="inner">
								
			
						<p class="cie-name"><a href="http://pressbooks.com">Pressbooks.com: Simple Book Production</a></p>
	</div><!-- #inner -->
</div><!-- #footer -->
</span><!-- schema.org -->
<script type='text/javascript' src='/jpainaday/wp-content/plugins/pressbooks/themes-book/pressbooks-book/js/keyboard-nav.js?ver=20130306'></script>
<script type='text/javascript' src='/jpainaday/wp-includes/js/wp-embed.min.js?ver=4.4'></script>
</body>
</html>
